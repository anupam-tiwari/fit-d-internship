<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>super MOM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdn.shoelace.style/1.0.0-beta24/shoelace.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="styles3.css">

    
    <script src="https://unpkg.com/docx@5.0.2/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
</head>

<body>
<div class="container"> 
     <div class="raw">
     <div class="col-6">
        <h1>
            My MOM
        </h1>
        </div>
        <div class="col-6">
          <button onclick="window.location.href='https://www.fitdhires.com/'" class="button-xl" style="background-color: #972899;"><i class="fa fa-arrow-left"></i> Back</button>
          <button onclick="window.location.href='previous.html'"  class="button-xl" style="background-color: #972899;"><i class="fa fa-history"></i> Previous Transcripts</button>
        </div>
      </div>

        
        
        <hr/>

        <div class="col">
            <label>Language: </label>
            <select id="language">
                <optgroup label="English">
                    <option value="en-US">US English (en-US)</option>
                    <option value="en-AU">Australian English (en-AU)</option>
                    <option value="en-GB">British English (en-GB)</option>
                </optgroup>
                <optgroup label="French">
                    <option value="fr-CA">Canadian French (fr-CA)</option>
                    <option value="fr-FR">French (fr-FR)</option>
                </optgroup>
                <optgroup label="Spanish">
                    <option value="es-US">US Spanish (es-US)</option>
                </optgroup>
            </select>


<!--
            <label>Region:</label>
                <select id="region">
                    <option value="us-east-1">US East (N. Virginia)</option>
                    <option value="us-east-2">US East (Ohio)</option>
                    <option value="us-west-2">US West (Oregon)</option>
                    <option value="ap-southeast-2">Asia Pacific (Sydney)</option>
                    <option value="ca-central-1">Canada (Central)</option>
                    <option value="eu-west-1">EU (Ireland)</option>
                </select>

-->
           
        </div>

        <hr>




        <h3 class="col-6"> Instructions</h3>
        <ul>
                                 
          <p >1. Press Start to record </p>
          <p >2. Press Stop to pause</p>
          <p  class="no-notes">3. Press Save button to store it on our database</p>
          <p  class="no-notes">4. Press Download to download speech</p>
          <p  class="no-notes">5. Press Email to send transcript</p>
      
  </ul>
                



     
        <div id="error" class="isa_error"></div>

        <div class="row">
           
           
        </div>
        <textarea id="transcript" placeholder="Press Start and speak into your mic" rows="5" readonly="true"> </textarea>
        <div class="row">
            <div class="col" style=" ">
                <button id="start-button" class="button-xl" title="Start Transcription" style="background-color: #972899; align-items: center; padding-left: cm;">
                    <i class="fa fa-microphone"></i> Start
                </button>
                <button id="stop-button" class="button-xl" title="Stop Transcription" disabled="true" style="background-color: #972899;"><i
                        class="fa fa-stop-circle"></i> Stop
                </button>
                <button id="reset-button" class="button-xl button-secondary" title="Clear Transcript" style="background-color: #972899;"> <i class="fa fa-eraser"></i>
                    Clear Transcript
                </button>
                
                

                
                <button id="save-note-btn" class="button-xl button-secondary" title="Save Note" style=background:#972899><i class="fa fa-bookmark"></i> Save Note</button> 


                <button id="download" class="button-xl button-secondary" title="Download Transcript"  onclick="generate();" > <i class="fa fa-arrow-circle-down"></i>
                  Download
              </button>

              


              

              <button id="send" class="button-xl button-secondary" title="send email"  onclick="myFunction(); "> <i class="fa fa-envelope"></i>
                 Mail  
              </button> 

              
                
               <script>
                   function myFunction() {
                      window.open("https://mail.google.com/mail/u/0/?view=cm&fs=1&to=someone@example.com&su=Mock Interview Transcript Review&body= Please replace this text with a note to your mentor and attach your downloaded transcript to this email to receive feedback from your expert mentor shortly!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          We're here to help! Hello@fitdhires.com &cc=hello@fitdhires.com&bcc=someone.else@example.com&tf=1',Mail,'width=560,height=340,toolbar=0,menubar=0,location=0");
                    }
                </script>
            </div>
          
            
            

        </div>
        <p id="recording-instructions">Press the <strong>Start</strong> button and allow access.</p>

        
        


        
                
                
                


                
        

        <div class="col">
                
          <input type="email" id="access_id" placeholder="ACCESS ID" value="xxxxxxxxxxxx" style="visibility: hidden;"/>

            
          <input type="email" id="secret_key" placeholder="SECRET KEY" value="xxxxxxxxxxxxxxxxx" style="visibility: hidden;" />
         
        </div>
    </div>
  </div>
   

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="dist/main.js"></script>
    
    

</body>




<script>
  function generate() {
            const doc = new docx.Document();


            const msg = document.getElementById('transcript');
            let data = '' + msg.value;

            doc.addSection({
                properties: {},
                children: [
                    new docx.Paragraph({
                        children: [
                        new docx.TextRun({
                                text: 'My Transcript :',
                                bold: true,

                                
                            }),
                            
                            new docx.TextRun({
                                text: data,
                                
                            }),
                            
                        ],
                    }),
                ],
            });

            docx.Packer.toBlob(doc).then(blob => {
                console.log(blob);
                saveAs(blob, "transcript.docx");
                console.log("Document created successfully");
            });
        }




        try {
  var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  var recognition = new SpeechRecognition();
}
catch(e) {
  console.error(e);
  $('.no-browser-support').show();
  $('.app').hide();
}


var noteTextarea = $('#transcript');
var instructions = $('#recording-instructions');
var notesList = $('ul#notes');
 

var noteContent = " ";

// Get all notes from previous sessions and display them.
var notes = getAllNotes();
renderNotes(notes);



/*-----------------------------
      Voice Recognition 
------------------------------*/

// If false, the recording will stop after a few seconds of silence.
// When true, the silence period is longer (about 15 seconds),
// allowing us to keep recording even when the user pauses. 
recognition.continuous = true;

// This block is called every time the Speech APi captures a line. 
recognition.onresult = function(event) {

  // event is a SpeechRecognitionEvent object.
  // It holds all the lines we have captured so far. 
  // We only need the current one.
  var current = event.resultIndex;

  // Get a transcript of what was said.
  var transcript = event.results[current][0].transcript;

  // Add the current transcript to the contents of our Note.
  // There is a weird bug on mobile, where everything is repeated twice.
  // There is no official solution so far so we have to handle an edge case.
  var mobileRepeatBug = (current == 1 && transcript == event.results[0][0].transcript);

  if(!mobileRepeatBug) {
    noteContent += transcript;
    noteTextarea.val(noteContent);
  }
};



//recognition.onstart = function() { 
//  instructions.text('Voice recognition activated. Try speaking into the microphone.');
//}

//recognition.onspeechend = function() {
 /// instructions.text('You were quiet for a while so voice recognition turned itself off.');
//}

recognition.onerror = function(event) {
  if(event.error == 'no-speech') {
    instructions.text('No speech was detected. Try again.');  
  };
}


function test(){
  console.log(noteContent)
  console.log('#transcript')
}


/*-----------------------------
      App buttons and input 
------------------------------*/

$('#start-button').on('click', function(e) {
  if (noteContent.length) {
    noteContent += ' ';
    
  }
  //recognition.start();
  instructions.text('Voice recognition activated. Try speaking into the microphone.');
});


$('#stop-button').on('click', function(e) {
  awsdata = document.getElementById('transcript');
  noteContent = awsdata.value
  console.log(noteContent);
  
  instructions.text('Voice recognition paused.');
});

// Sync the text inside the text area with the noteContent variable.
//noteTextarea.on('input', function() {
 // noteContent = $(this).val();
 // console.log(noteContent)
//})

$('#save-note-btn').on('click', function(e) {
    //recognition.stop();
    //if(!noteContent.length) {
    // instructions.text('Could not save empty note. Please add a message to your note.');
    // }
    //  else {
    // Save note to localStorage.
    // The key is the dateTime with seconds, the value is the content of the note.
    saveNote(new Date().toLocaleString(), noteContent);
    console.log()
    
    


    // Reset variables and update UI.
    //noteContent = '';
    renderNotes(getAllNotes());
    //noteTextarea.val('');
    instructions.text('Note saved successfully.');
  //}
      
})


notesList.on('click', function(e) {
  e.preventDefault();
  var target = $(e.target);

  // Listen to the selected note.
  if(target.hasClass('listen-note')) {
    var content = target.closest('.note').find('.content').text();
    readOutLoud(content);
  }

  // Delete note.
  if(target.hasClass('delete-note')) {
    var dateTime = target.siblings('.date').text();  
    deleteNote(dateTime);
    target.closest('.note').remove();
  }
});



/*-----------------------------
      Speech Synthesis 
------------------------------*/

function readOutLoud(message) {
	var speech = new SpeechSynthesisUtterance();

  // Set the text and voice attributes.
	speech.text = message;
	speech.volume = 1;
	speech.rate = 1;
	speech.pitch = 1;
  
	window.speechSynthesis.speak(speech);
}



/*-----------------------------
      Helper Functions 
------------------------------*/

function renderNotes(notes) {
  var html = '';
  if(notes.length) {
    notes.forEach(function(note) {
      html+= `<li class="note">
        <p class="header">
          <span class="date">${note.date}</span>
          <a href="#" class="listen-note" title="Listen to Note">Listen to Note</a>
          <a href="#" class="delete-note" title="Delete">Delete</a>
        </p>
        <p class="content" style="width: 250px">${note.content}</p>
      </li>`;    
    });
  }
  else {
    html = '<li><p class="content">You don\'t have any notes yet.</p></li>';
  }
  notesList.html(html);
}


function saveNote(dateTime, content) {
  localStorage.setItem( 'note-' + dateTime, content);
  
}


function getAllNotes() {
  var notes = [];
  var key;
  for (var i = 0; i < localStorage.length; i++) {
    key = localStorage.key(i);
    

    if(key.substring(0,5) == 'note-') {
      notes.push({
        date: key.replace('note-',''),
        content: localStorage.getItem(localStorage.key(i))
        
      });
    } 
  }
  return notes;
}


function deleteNote(dateTime) {
  localStorage.removeItem('note-' + dateTime); 
}


</script>


</html>

